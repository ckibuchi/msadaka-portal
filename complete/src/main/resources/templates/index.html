<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="utf-8" />
        <title>M-Sadaka</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
        <meta content="The easiest way to manage Church collections" name="description" />
        <meta content="Coderthemes" name="author" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />

        <link rel="shortcut icon" href="assets/images/favicon.ico">


        <link href="assets/plugins/jquery-circliful/css/jquery.circliful.css" rel="stylesheet" type="text/css" />

        <!-- App css -->
        <link href="assets/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
        <link href="assets/css/icons.css" rel="stylesheet" type="text/css" />
        <link href="assets/css/style.css" rel="stylesheet" type="text/css" />

        <script src="assets/js/modernizr.min.js"></script>

    </head>

    <body>

        <!-- Navigation Bar-->
        <header id="topnav">
            <div class="topbar-main">
                <div class="container-fluid">

                    <!-- Logo container-->
                    <div class="logo">
                        <!-- Text Logo -->
                        <a href="index.html" th:href="@{/}" class="logo">
                            <span class="logo-small"><i class="mdi mdi-radar"></i></span>
                            <span class="logo-large"><i class="mdi mdi-radar"></i> M-Sadaka</span>
                        </a>
                        <!-- Image Logo -->
                        <!--<a href="index.html" th:href="@{/}" class="logo">-->
                        <!--<img src="assets/images/logo_dark.png" alt="" height="24" class="logo-lg">-->
                        <!--<img src="assets/images/logo_sm.png" alt="" height="24" class="logo-sm">-->
                        <!--</a>-->

                    </div>
                    <!-- End Logo container-->


                    <div class="menu-extras topbar-custom">

                        <ul class="list-inline float-right mb-0">

                            <li class="menu-item list-inline-item">
                                <!-- Mobile menu toggle-->
                                <a class="navbar-toggle nav-link">
                                    <div class="lines">
                                        <span></span>
                                        <span></span>
                                        <span></span>
                                    </div>
                                </a>
                                <!-- End mobile menu toggle-->
                            </li>
                            <li class="list-inline-item dropdown notification-list">
                                <a class="nav-link dropdown-toggle arrow-none waves-effect" data-toggle="dropdown" th:href="@{/}" role="button"
                                   aria-haspopup="false" aria-expanded="false">
                                    <i class="mdi mdi-bell noti-icon"></i>
                                    <span class="badge badge-pink noti-icon-badge">0</span>
                                </a>
                                <div class="dropdown-menu dropdown-menu-right dropdown-arrow dropdown-menu-lg" aria-labelledby="Preview">
                                    <!-- item-->
                                    <div class="dropdown-item noti-title">
                                        <h5 class="font-16"><span class="badge badge-danger float-right">0</span>Notification</h5>
                                    </div>



                                </div>
                            </li>

                            <li class="list-inline-item dropdown notification-list">
                                <a class="nav-link dropdown-toggle waves-effect nav-user" data-toggle="dropdown" th:href="@{/}" role="button"
                                   aria-haspopup="false" aria-expanded="false">
                                    <img src="assets/images/users/avatar-1.png" alt="user" class="rounded-circle">
                                </a>
                                <div class="dropdown-menu dropdown-menu-right profile-dropdown " aria-labelledby="Preview">
                                    <!-- item-->
                                    <div class="dropdown-item noti-title">
                                        <h5 class="text-overflow"><small class="text-white" th:text="'Welcome '+${userName}"></small> </h5>
                                    </div>

                                    <!-- item-->
                                    <a href="javascript:void(0);" class="dropdown-item notify-item">
                                        <i class="mdi mdi-account"></i> <span>Profile</span>
                                    </a>



                                    <!-- item-->
                                    <a th:href="@{/logout}" class="dropdown-item notify-item">
                                        <i class="mdi mdi-logout"></i> <span>Logout</span>
                                    </a>
                                </div>
                            </li>

                        </ul>
                    </div>
                    <!-- end menu-extras -->

                    <div class="clearfix"></div>

                </div> <!-- end container -->
            </div>
            <!-- end topbar-main -->

            <div class="navbar-custom">
                <div class="container-fluid">
                    <div id="navigation">
                        <!-- Navigation Menu-->
                        <ul class="navigation-menu">

                            <li class="has-submenu">
                                <a href="index.html" th:href="@{/}"><i class="ti-home"></i>Dashboard</a>
                            </li>
<!--
                            <li class="has-submenu">
                                <a th:href="@{/}"><i class="ti-paint-bucket"></i>UI Kit</a>
                                <ul class="submenu">
                                    <li><a href="ui-buttons.html">Buttons</a></li>
                                    <li><a href="ui-cards.html">Cards</a></li>
                                    <li><a href="ui-portlets.html">Portlets</a></li>
                                    <li><a href="ui-checkbox-radio.html">Checkboxs-Radios</a></li>
                                    <li><a href="ui-tabs.html">Tabs & Accordions</a></li>
                                    <li><a href="ui-modals.html">Modals</a></li>
                                    <li><a href="ui-progressbars.html">Progress Bars</a></li>
                                    <li><a href="ui-notification.html">Notification</a></li>
                                    <li><a href="ui-bootstrap.html">BS Elements</a></li>
                                    <li><a href="ui-typography.html">Typography</a></li>
                                </ul>
                            </li>

                            <li class="has-submenu">
                                <a th:href="@{/}"><i class="ti-light-bulb"></i>Components</a>
                                <ul class="submenu">
                                    <li><a href="components-grid.html">Grid</a></li>
                                    <li><a href="components-carousel.html">Carousel</a></li>
                                    <li><a href="components-widgets.html">Widgets</a></li>
                                    <li><a href="components-nestable-list.html">Nesteble</a></li>
                                    <li><a href="components-range-sliders.html">Range Sliders </a></li>
                                    <li><a href="components-sweet-alert.html">Sweet Alerts </a></li>
                                </ul>
                            </li>
-->
                            <li class="has-submenu">
                                <a th:href="@{/}"><i class="ti-spray"></i>Reports</a>
                               <ul class="submenu">
                                   <!--
                                    <li class="has-submenu">
                                        <a th:href="@{/}">Icons</a>
                                        <ul class="submenu">
                                            <li><a href="icons-materialdesign.html">Material Design</a></li>
                                            <li><a href="icons-themifyicon.html">Themify Icons</a></li>
                                            <li><a href="icons-ionicons.html">Ion Icons</a></li>
                                            <li><a href="icons-fontawesome.html">Font awesome</a></li>
                                            <li><a href="icons-weather.html">Weather Icons</a></li>
                                        </ul>
                                    </li>

                                    <li class="has-submenu">
                                        <a th:href="@{/}">Forms</a>
                                        <ul class="submenu">
                                            <li><a href="form-elements.html">General Elements</a></li>
                                            <li><a href="form-advanced.html">Advanced Form</a></li>
                                            <li><a href="form-validation.html">Form Validation</a></li>
                                            <li><a href="form-wizard.html">Form Wizard</a></li>
                                            <li><a href="form-wysiwig.html">WYSIWYG Editor</a></li>
                                            <li><a href="form-summernote.html">Summernote</a></li>
                                            <li><a href="form-uploads.html">Multiple File Upload</a></li>
                                            <li><a href="form-xeditable.html">X-editable</a></li>
                                        </ul>
                                    </li>
                                       -->
                                    <li class="has-submenu">
                                        <a th:href="@{/transactions}">Transactions</a>
                                        <!-- <ul class="submenu">
                                           <li><a href="tables-basic.html">Basic Tables</a></li>
                                            <li><a href="@{/transactions}">Transactions</a></li>
                                           <li><a href="tables-editable.html">Editable Table</a></li>
                                            <li><a href="tables-responsive.html">Responsive Table</a></li>
                                            <li><a href="tables-tablesaw.html">Tablesaw</a></li>
                                            <li><a href="tables-foo-tables.html">Foo Table</a></li>
                                        </ul>-->
                                    </li>
                            <!--

                                    <li class="has-submenu">
                                        <a th:href="@{/}">Charts</a>
                                        <ul class="submenu">
                                            <li><a href="chart-flot.html">Flot Chart</a></li>
                                            <li><a href="chart-morris.html">Morris Chart</a></li>
                                            <li><a href="chart-chartist.html">Chartist chart</a></li>
                                            <li><a href="chart-nvd3.html">Nvd3 charts</a></li>
                                            <li><a href="chart-chartjs.html">Chartjs Charts</a></li>
                                            <li><a href="chart-peity.html">Peity Charts</a></li>
                                            <li><a href="chart-sparkline.html">Sparkline Charts</a></li>
                                            <li><a href="chart-other.html">Other Chart</a></li>
                                        </ul>

                                    </li>


                                    <li class="has-submenu">
                                        <a th:href="@{/}">Maps</a>
                                        <ul class="submenu">
                                            <li><a href="map-google.html"> Google Map</a></li>
                                            <li><a href="map-vector.html"> Vector Map</a></li>
                                        </ul>
                                    </li>

                                    <li class="has-submenu">
                                        <a th:href="@{/}">Mail</a>
                                        <ul class="submenu">
                                            <li><a href="mail-inbox.html">Inbox</a></li>
                                            <li><a href="mail-compose.html">Compose Mail</a></li>
                                            <li><a href="mail-read.html">View Mail</a></li>
                                        </ul>
                                    </li>
                                </ul>
                            </li>

                            <li class="has-submenu">
                                <a th:href="@{/}"><i class="ti-files"></i>Pages</a>
                                <ul class="submenu megamenu">
                                    <li>
                                        <ul>
                                            <li><a href="pages-starter.html">Blank Page</a></li>
                                            <li><a th:href="@{/}" >Login</a></li>
                                            <li><a th:href="@{/registration}" >Register</a></li>
                                            <li><a href="pages-recoverpw.html">Recover Password</a></li>
                                        </ul>
                                    </li>
                                    <li>
                                        <ul>
                                            <li><a href="pages-lock-screen.html">Lock Screen</a></li>
                                            <li><a href="pages-confirmmail.html">Confirm Mail</a></li>
                                            <li><a href="pages-404.html">404 Error</a></li>
                                            <li><a href="pages-500.html">500 Error</a></li>
                                        </ul>
                                    </li>
                                </ul>
                            </li>

                            <li class="has-submenu">
                                <a th:href="@{/}"><i class="ti-gift"></i>Extras</a>
                                <ul class="submenu megamenu">
                                    <li>
                                        <ul>
                                            <li><a href="extras-profile.html">Profile</a></li>
                                            <li><a href="extras-team.html">Team Members</a></li>
                                            <li><a href="extras-timeline.html">Timeline</a></li>
                                            <li><a href="extras-invoice.html">Invoice</a></li>
                                            <li><a href="extras-calendar.html"> Calendar</a></li>
                                            <li><a href="extras-email-template.html">Email template</a></li>
                                        </ul>
                                    </li>
                                    <li>
                                        <ul>
                                            <li><a href="extras-maintenance.html">Maintenance</a></li>
                                            <li><a href="extras-coming-soon.html">Coming-soon</a></li>
                                            <li><a href="extras-gallery.html"> Gallery</a></li>
                                            <li><a href="extras-pricing.html">Pricing</a></li>
                                            <li><a href="extras-faq.html">FAQ</a></li>
                                            <li><a href="extras-treeview.html">Treeview</a></li>
                                        </ul>
                                    </li>
                                </ul>
                                -->
                            </li>
                               </ul>

                        </ul>
                        <!-- End navigation menu -->
                    </div> <!-- end #navigation -->
                </div> <!-- end container -->
            </div> <!-- end navbar-custom -->
        </header>
        <!-- End Navigation Bar-->


        <div class="wrapper">
            <div class="container-fluid">

                <!-- Page-Title -->
                <div class="row">
                    <div class="col-sm-12">
                        <div class="page-title-box">
                            <div class="btn-group pull-right">
                                <ol class="breadcrumb hide-phone p-0 m-0">
                                    <li class="breadcrumb-item"><a th:href="@{/}">M-Sadaka</a></li>
                                    <li class="breadcrumb-item active">Dashboard</li>
                                </ol>
                            </div>
                            <h4 class="page-title" th:text="'Welcome ' + ${userName}">Welcome !</h4>
                        </div>
                    </div>
                </div>
                <!-- end page title end breadcrumb -->


                <div class="row">
                    <div class="col-sm-6 col-xl-3">
                        <div class="widget-simple-chart text-right card-box">
                            <div class="circliful-chart" data-dimension="90" data-text="100%" data-width="5" data-fontsize="14" data-percent="100" data-fgcolor="#5fbeaa" data-bgcolor="#ebeff2"></div>
                            <h3 class="text-success counter m-t-10" th:text="${todays_txns}">0</h3>
                            <p class="text-muted text-nowrap m-b-10">Today's Transactions</p>
                        </div>
                    </div>
<!--
                    <div class="col-sm-6 col-xl-3">
                        <div class="widget-simple-chart text-right card-box">
                            <div class="circliful-chart" data-dimension="90" data-text="100%" data-width="5" data-fontsize="14" data-percent="100" data-fgcolor="#3bafda" data-bgcolor="#ebeff2"></div>
                            <h3 class=" counter m-t-10" ><span class="counter" th:text="${todays_sales}">0.00</span></h3>
                            <p class="text-muted text-nowrap m-b-10">Today's Sales</p>
                        </div>
                    </div>
-->



                    <div class="col-sm-6 col-xl-3">
                        <div class="widget-simple-chart text-right card-box">
                            <div class="circliful-chart" data-dimension="90" data-text="100%" data-width="5" data-fontsize="14" data-percent="100" data-fgcolor="#3bafda" data-bgcolor="#ebeff2"></div>
                            <h3 class=" m-t-10" >Ksh. <span class="counter" th:text="${todays_sales}">0.00</span></h3>
                            <p class="text-muted text-nowrap m-b-10">Today's Collections</p>
                        </div>
                    </div>


                    <div class="col-sm-6 col-xl-3">
                        <div class="widget-simple-chart text-right card-box">
                            <div class="circliful-chart" data-dimension="90" data-text="100%" data-width="5" data-fontsize="14" data-percent="100" data-fgcolor="#98a6ad" data-bgcolor="#ebeff2"></div>
                            <h3 >Ksh. <span class="counter" th:text="${monthly_sales}">0.00</span></h3>
                            <p class="text-muted text-nowrap m-b-10">Monthly Collections</p>
                        </div>
                    </div>

                    <div class="col-sm-6 col-xl-3">

                        <div class="widget-simple-chart text-right card-box">
                            <div class="circliful-chart" data-dimension="90" data-text="100%" data-width="5" data-fontsize="14" data-percent="100" data-fgcolor="#f76397" data-bgcolor="#ebeff2"></div>
                            <h3 class="text-pink m-t-10">  Ksh. <span class="counter" th:text="${forever_sales}">0.00</span></h3>
                            <p class="text-muted text-nowrap m-b-10">Total Collections</p>
                        </div>
                    </div>


                </div>
                <!-- end row -->



                <div class="row">
                    <div class="col-lg-12">
                        <div class="card-box">
                            <h4 class="text-dark  header-title m-t-0">Your PayBills</h4>
                            <p class="text-muted m-b-25 font-13">
                               <button type="button" class="btn btn-primary waves-effect waves-light btn-sm" data-toggle="modal" onclick="newPayBill();">ADD PayBill</button>
                            </p>


                            <div class="table-rep-plugin">
                                <div class="table-responsive" data-pattern="priority-columns">
                                <table class="table mb-0 table-hover .table-striped" id="paybills">
                                    <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Short Code</th>
                                        <th>PayBill Number</th>
                                        <th>A/C Name</th>
                                        <th>Creation Date</th>
                                        <th>Due Date</th>
                                        <th>Status</th>
                                        <th>Action</th>
                                    </tr>
                                    </thead>
                                    <tbody>

                                    </tbody>
                                </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- end col -12-->



                </div>
                <!-- end row -->
				
				
				<!-- Modal to Register a new Paybill -->


            </div> <!-- end container -->
        </div>
        <!-- end wrapper -->
        <div id="create-paybill-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                        <h4 class="modal-title">PayBill Details</h4>
                    </div>
                    <div class="modal-body">
					<form class="col-md-12" role="form" method="post"  action="#" id="PayBillForm">
                        <input type="hidden" name="id" id="id" value="" />
                        <div class="row">
						  
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="name" class="control-label">PayBill Name</label>
                                    <input type="text" class="form-control" id="name" name="name" autocomplete='off' placeholder="Business Name">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="mpesaPasskey" class="control-label">Passkey</label>
                                    <input type="password" class="form-control" id="mpesaPasskey" name="mpesaPasskey" autocomplete='off'  placeholder="Mpesa PassKey">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="shortCode" class="control-label">H/Office Short Code</label>
                                    <input type="text" class="form-control" id="shortCode" name="shortCode" autocomplete='off' placeholder="Head Office Short Code">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="payBill" class="control-label">PayBill No.</label>
                                    <input type="text" class="form-control" id="payBill" name="payBill" autocomplete='off' placeholder="PayBill No.">
                                </div>
                            </div>
                        </div>

                    <div class="modal-footer">
					<div class="loading text-center">
								<img id="loader" src="assets/images/Preloader_2.gif" />
							</div>
                        <button type="button" class="btn btn-secondary waves-effect" data-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-info waves-effect waves-light"  id="submit" onclick="submitPayBill();" >Save changes</button>
                    </div>
					 </form>  
                </div>
            </div>
        </div><!-- /.modal -->
        </div>
		
		
		<div id="delete_paybill" class="modal custom-modal fade" role="dialog">
			<div class="modal-dialog">
				<div class="modal-content modal-md">
					<div class="modal-header">
						<h4 class="modal-title">Delete PayBill</h4>
					</div>
                    <div class="del_loading text-center">
                        <img id="del_loader" src="assets/images/Preloader_2.gif" />
                        <p>Deleting..</p>
                    </div>
					<form id="deletePayBill" role="form" method="post" action="#">
						<div class="modal-body card-box">
                            <input type="hidden" id="payBillId" name="payBillId" value="" />
							<p id="question">Are you sure want to delete this?</p>
							<div class="m-t-20"> <a href="#" class="btn btn-default" data-dismiss="modal">Close</a>
								<button  type="button" class="btn btn-danger" id="submit"  onclick="deletePayBill();">Delete</button>
							</div>
						</div>
					</form>
				</div>
			</div>
		</div>
		

        <!-- Footer -->
        <footer class="footer">
            <div class="container">
                <div class="row">
                    <div class="col-12 text-center" th:text="${footer}">

                    </div>
                </div>
            </div>
        </footer>
        <!-- End Footer -->
    </body>


        <!-- jQuery  -->
        <script src="assets/js/jquery.min.js"></script>
        <script src="assets/js/popper.min.js"></script><!-- Popper for Bootstrap --><!-- Tether for Bootstrap -->
        <script src="assets/js/bootstrap.min.js"></script>
        <script src="assets/js/waves.js"></script>
        <script src="assets/js/jquery.slimscroll.js"></script>
        <script src="assets/js/jquery.scrollTo.min.js"></script>

        <!-- Counter Up  -->
        <script src="assets/plugins/waypoints/lib/jquery.waypoints.min.js"></script>
        <script src="assets/plugins/counterup/jquery.counterup.min.js"></script>

        <!-- circliful Chart -->
        <script src="assets/plugins/jquery-circliful/js/jquery.circliful.min.js"></script>
        <script src="assets/plugins/jquery-sparkline/jquery.sparkline.min.js"></script>

        <!-- skycons -->
        <script src="assets/plugins/skyicons/skycons.min.js" type="text/javascript"></script>

        <!-- Page js  -->
        <script src="assets/pages/jquery.dashboard.js"></script>

        <!-- Custom main Js -->
        <script src="assets/js/jquery.core.js"></script>
        <script src="assets/js/jquery.app.js"></script>
		<script type="text/javascript" src="assets/js/functions.js"> </script> 
 


        <script type="text/javascript">
            jQuery(document).ready(function($) {
                $('.counter').counterUp({
                    delay: 100,
                    time: 1200
                });
                $('.circliful-chart').circliful();
            });

            // BEGIN SVG WEATHER ICON
            if (typeof Skycons !== 'undefined'){
                var icons = new Skycons(
                        {"color": "#3bafda"},
                        {"resizeClear": true}
                        ),
                        list  = [
                            "clear-day", "clear-night", "partly-cloudy-day",
                            "partly-cloudy-night", "cloudy", "rain", "sleet", "snow", "wind",
                            "fog"
                        ],
                        i;

                for(i = list.length; i--; )
                    icons.set(list[i], list[i]);
                icons.play();
            };

        </script>
		<script  th:inline="javascript">
    /*<![CDATA[*/
	var username = /*[[${userName}]]*/ '';

	/*]]>*/
</script>
		<script type="text/javascript">
		$(document).ready(function(){
		  $(".loading").hide();
		var i=0;
            $.ajax({
                type: "POST",
                url: "/getPayBills",
                data: '$format=json',
                dataType: 'json',
                success: function (data) {
				var response = $.parseJSON(JSON.stringify(data));
				console.log('response >> '+response);
                      $.each(response, function(i, results) {
					i+=1;

                        $("#paybills tbody").append(
                            '<tr>'
                            +'<td>'+i+'</td>'
                            +'<td>'+results.shortCode+'</td>'
                            +'<td>'+results.payBill+'</td>'
                            +'<td>'+results.name+'</td>'
                            +'<td>'+results.creationDate+'</td>'
							+'<td>'+results.creationDate+'</td>'
                            +'<td><span class="badge badge-info">'+results.status+'</span></td>'
                            +'<td>' +
                            '<div class="dropdown profile-action">' +
                            '<a href="#" class="action-icon dropdown-toggle" data-toggle="dropdown" aria-expanded="false"><i class="fa fa-ellipsis-v"></i></a>'+
                            '<ul class="dropdown-menu pull-right">'+
                            '<li><a href="#" data-toggle="modal" onclick="editPayBill('+results.id+',\''+results.name+'\',\''+results.mpesaPasskey+'\',\''+results.shortCode+'\',\''+results.payBill+'\');"  ><i class="fa fa-pencil m-r-5"></i> Edit</a></li>'+
                            '<li><a href="#" data-toggle="modal" onclick="showdeletePayBill('+results.id+',\''+results.name+'\',\''+results.mpesaPasskey+'\',\''+results.shortCode+'\',\''+results.payBill+'\');"  ><i class="fa fa-trash-o m-r-5"></i> Delete</a></li>'+
                            '</ul>'+
                            '</div>'+
                            '</td>'
                            +'</tr>' )
                    })
                }

            });



        });

		</script>

        <script>
            $(function() {
                $('.table-responsive').responsiveTable({
                    addDisplayAllBtn: 'btn btn-secondary'
                });
            });
        </script>
        <script type="text/javascript">
        /*<![CDATA[*/
        var totalpayBills =/*[[${totalpayBills}]]*/ $('#paybills tr').length;
     //   var totalpayBills = $('#paybills tr').length;
        /*]]>*/
        </script>
</html> 